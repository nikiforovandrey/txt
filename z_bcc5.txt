z_bcc5a:--z_bcc5a
declare @t_bdate nvarchar(10) 
declare @t_edate nvarchar(10) 
declare @t_bbccno nvarchar(20) 
declare @t_ebccno nvarchar(20) 
declare @t_store nvarchar(max) 
set @t_bdate = case when '#non'=[1] then '' else [1] end
set @t_edate = case when '#non'=[2] then char(255) else [2] end
set @t_bbccno = case when '#non'=[3] then '' else [3] end
set @t_ebccno = case when '#non'=[4] then char(255) else [4] end
set @t_store = case when '#non'=[5] then '' else [5] end
declare @tmp table( 
gno nvarchar(1), 
typea nvarchar(11), 
bccno nvarchar(30), 
bccname nvarchar(80), 
stkmount float,
avgprice float,
total float, 
tgg nvarchar(50)
) 
if(@t_store = '99') 
begin 
insert into @tmp 
select '0',typea,noa,product,stkmount,round((case when stkmount > 0 then price/stkmount else '0' end),2),
	   case when stkmount > 0 then (price+tax) else '0' end,'' 
from bcc 
where (begindate between @t_bdate and @t_edate) and (noa between @t_bbccno and @t_ebccno) 
end 
else 
begin 
insert into @tmp 
select '0',typea,noa,product,stkmount,round((case when stkmount > 0 then price/stkmount else '0' end),2),
	   case when stkmount > 0 then (price+tax) else '0' end,'' 
from bcc 
where (begindate between @t_bdate and @t_edate) and (noa between @t_bbccno and @t_ebccno) and 
(storeno = @t_store) 
end 
select * from @tmp;
--*****************************************************************************************	
z_bcc5b:--z_bcc5b
declare @t_bdate nvarchar(10)
declare @t_edate nvarchar(10)
declare @t_bbccno nvarchar(20)
declare @t_ebccno nvarchar(20)
declare @t_store nvarchar(max)
set @t_bdate = case when '#non'=[1] then '' else [1] end
set @t_edate = case when '#non'=[2] then char(255) else [2] end
set @t_bbccno = case when '#non'=[3] then '' else [3] end
set @t_ebccno = case when '#non'=[4] then char(255) else [4] end
set @t_store = case when '#non'=[5] then '' else [5] end
declare @tmp table(
	gno nvarchar(1),
	typea nvarchar(11),
	bccno nvarchar(30),
	bccname nvarchar(80),
	mon nvarchar(10),
	stkmount float,
	tgg nvarchar(50),
	memo nvarchar(MAX)
)
if(@t_store = '99')
begin
	insert into @tmp
		select '0',typea,noa,product,begindate,stkmount,'',memo2
		from bcc
		where (begindate between @t_bdate and @t_edate) and (noa between @t_bbccno and @t_ebccno)
end
else
begin
	insert into @tmp
	select '0',typea,noa,product,begindate,stkmount,'',memo2
	from bcc
	where (begindate between @t_bdate and @t_edate) and (noa between @t_bbccno and @t_ebccno) and 
		  (storeno = @t_store)
end
select * from @tmp;
--*****************************************************************************************
z_bcc5c:--z_bcc5c
declare @t_bdate nvarchar(10)
declare @t_edate nvarchar(10)
declare @t_bbccno nvarchar(20)
declare @t_ebccno nvarchar(20)
declare @t_store nvarchar(max)
declare @t_part nvarchar(max)
set @t_bdate = case when '#non'=[1] then '' else [1] end
set @t_edate = case when '#non'=[2] then char(255) else [2] end
set @t_bbccno = case when '#non'=[3] then '' else [3] end
set @t_ebccno = case when '#non'=[4] then char(255) else [4] end
set @t_store = case when '#non'=[5] then '' else [5] end
set @t_part = case when '#non'=[6] then '' else [6] end
declare @tmp table( 
	gno nvarchar(1),
	bccno nvarchar(30), 
	bccname nvarchar(50),
	storeno nvarchar(10),
	datea nvarchar(10),
	price float, 
	inmount float, 
	outmount float,
	stkmount float,
	usename nvarchar(50), 
	memo nvarchar(MAX)
)
insert into @tmp
select '0',a.bccno,bccname,a.storeno,b.datea,a.price,mount,'',isnull(c.stkmount,0) stkmount,'',a.memo
	   from bccins a
	   left join bccin b on a.noa = b.noa
	   left join bcc c on a.bccno = c.noa
	   where (b.datea between @t_bdate and @t_edate) and 
			 (a.bccno between @t_bbccno and @t_ebccno) and 
			 (len(@t_part) = 0 or charindex(b.part, @t_part) > 0) and
			 ((@t_store = '99') or (a.storeno = @t_store))
insert into @tmp
select '0',a.bccno,a.bccname,a.storeno,b.datea,'','',mount,isnull(c.stkmount,0) stkmount,b.sname,a.memo
	   from bccouts a
	   left join bccout b on a.noa = b.noa
	   left join bcc c on a.bccno = c.noa
	   where (b.datea between @t_bdate and @t_edate) and 
			 (a.bccno between @t_bbccno and @t_ebccno) and 
			 (len(@t_part) = 0 or charindex(b.part, @t_part) > 0) and
			 ((@t_store = '99') or (a.storeno = @t_store))
insert into @tmp(bccno,bccname,gno)
	select distinct(bccno),bccname,'1' from @tmp
select * from @tmp order by bccno,gno desc;
--*****************************************************************************************	
z_bcc599:--z_bcc599
	SET QUOTED_IDENTIFIER OFF
	declare @cmd nvarchar(max)
	declare @t_bdate nvarchar(10)
	declare @t_edate nvarchar(10)
	declare @t_bbccno nvarchar(20)
	declare @t_ebccno nvarchar(20)
	declare @t_store nvarchar(max)
	declare @t_part nvarchar(max)
	set @t_bdate = case when '#non'=[1] then '' else [1] end
	set @t_edate = case when '#non'=[2] then char(255) else [2] end
	set @t_bbccno = case when '#non'=[3] then '' else [3] end
	set @t_ebccno = case when '#non'=[4] then char(255) else [4] end
	set @t_store = case when '#non'=[5] then '' else [5] end
	set @t_part = case when '#non'=[6] then '' else [6] end
	-----------------------------------------------------------------------------
	declare @string nvarchar(max)
	declare @n int
	IF OBJECT_ID('tempdb..#store')is not null
	BEGIN
		set @cmd = 'drop table #store'
		EXECUTE sp_executesql @cmd
	END
	create table #store(
		noa nvarchar(20)
	)
	set @string = @t_store
	while(1=1)
	begin
		set @n = PATINDEX('%,%',@string)
		if @n=0
		begin
			if LEN(@string)>0
			begin
				insert into #store select @string
			end
			break
		end
		insert into #store select LEFT(@string,@n-1)	
		set @string = SUBSTRING(@string,@n+1,LEN(@string)-@n)
	end
	
	IF OBJECT_ID('tempdb..#part')is not null
	BEGIN
		set @cmd = 'drop table #part'
		EXECUTE sp_executesql @cmd
	END
	create table #part(
		noa nvarchar(20)
	)
	set @string = @t_part
	while(1=1)
	begin
		set @n = PATINDEX('%,%',@string)
		if @n=0
		begin
			if LEN(@string)>0
			begin
				insert into #part select @string
			end
			break
		end
		insert into #part select LEFT(@string,@n-1)	
		set @string = SUBSTRING(@string,@n+1,LEN(@string)-@n)
	end;
	--*****************************************************************************************	
	
