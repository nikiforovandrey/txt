z_trans1:--z_trans1

z_trans2:--z_trans2
declare @t_bxdate nvarchar(20)
declare @t_exdate nvarchar(20)
declare @t_bcustno nvarchar(20)
declare @t_ecustno nvarchar(20)
declare @t_carno nvarchar(20)
set @t_bxdate = case when '#non' = [2] then '' else [2] end
set @t_exdate = case when '#non' = [3] then CHAR(255) else [3] end
set @t_bcustno = case when '#non' = [4] then '' else [4] end
set @t_ecustno = case when '#non' = [5] then CHAR(255) else [5] end
set @t_carno = case when '#non' = [8] then '' else [8] end
declare @tmp table(
	gno nvarchar(1),
	noa	nvarchar(20),
	datea nvarchar(10),
	trandate nvarchar(10),
	mon nvarchar(10),
	mon2 nvarchar(10),
	carno nvarchar(20),
	driver nvarchar(20),
	custno nvarchar(20), 
	calctype nvarchar(10),
	carteam nvarchar(20),
	straddrno nvarchar(20),
	uccno nvarchar(20),
	mount decimal(18, 3),
	price decimal(18, 3) ,
	total float, 
	commission2 float,
	mount2 decimal(18, 3), 
	Price3 decimal(18, 3), 
	discount decimal(18, 3), 
	total2 float, 
	pton decimal(18, 3), 
	pton2 decimal(18, 3), 
	tolls float,
	reserve float,
	gross decimal(18, 3),
	weight decimal(18, 3),
	weight2 float,
	weight3 float, 
	caseno nvarchar(20), 
	caseuse nvarchar(20),
	casetype nvarchar(20), 
	po nvarchar(20),
	custorde nvarchar(20),
	sales nvarchar(20),
	bmiles float,
	emiles float, 
	miles float,
	ltime nvarchar(20), 
	stime nvarchar(20),
	dtime nvarchar(20), 
	cardealno nvarchar(20),
	add3 nvarchar(20), 
	gps float,
	third nvarchar(50),
	thirdprice float,
	ordeno float,
	so nvarchar(20),
	traceno nvarchar(20),
	unpack float,
	cldate nvarchar(20), 
	fill nvarchar(20), 
	caseend nvarchar(20), 
	status nvarchar(20),
	memo nvarchar(200),
	overw float,
	overh float,
	trdno nvarchar(20),
	treno nvarchar(20),
	boat nvarchar(30),
	boatname nvarchar(30),
	ship nvarchar(30)
)
insert into @tmp
	select '0',noa,datea,trandate,mon,mon2,carno,driver,custno,calctype,carteam,
			straddrno,uccno,mount,price,total,commission2,mount2,Price3,discount,  
			total2,pton,pton2,tolls,reserve,gross,weight,weight2,weight3,  
			caseno,caseuse,casetype,po,custorde,sales,bmiles,emiles,miles, 
			ltime,stime,dtime,cardealno,add3,gps,third,thirdprice,ordeno, 
			so,traceno,unpack,cldate,fill,caseend,status,memo,overw,overh,
			trdno,treno,boat,boatname,ship from trans[1]
	where (datea between @t_bxdate and @t_exdate) and (custno between @t_bcustno and @t_ecustno) and
		  ((len(@t_carno) = 0) or (carno = @t_carno))
select gno,noa,datea,trandate,mon,mon2,carno,driver,custno,calctype,carteam,straddrno,uccno,mount,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,price),1)),4,12)) price,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) total,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,commission2),1)),4,12)) commission2,mount2,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,Price3),1)),4,12)) Price3,discount,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total2),1)),4,12)) total2,pton,pton2,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,tolls),1)),4,12)) tolls,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,reserve),1)),4,12)) reserve,
gross,weight,weight2,weight3,caseno,caseuse,casetype,po,custorde,sales,bmiles,emiles,miles,
ltime,stime,dtime,cardealno,add3,gps,third, 
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,thirdprice),1)),4,12)) thirdprice,ordeno,so,traceno,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,unpack),1)),4,12)) unpack,
cldate,fill,caseend,status,memo,overw,overh,trdno,treno,boat,boatname,ship		
from @tmp order by datea,noa,trandate,mon,mon2,carno,custno;