z_tranquat:declare @t_noa nvarchar(15)
declare @t_baddr nvarchar(50)
declare @t_eaddr nvarchar(50)
set @t_noa = case when '#non'=[1] then '' else [1] end
set @t_baddr = case when '#non'=[2] then '' else [2] end
set @t_eaddr = case when '#non'=[3] then char(255) else [3] end


select '0' gno, a.noa,b.noq,a.comp,a.conn_cust,a.tel_cust,a.fax_cust,a.stype,a.thirdprice,a.datea,a.oil1,a.oil2,
b.product,b.straddr,b.mount,b.unit,b.price,b.memo
from tranquat a
left join tranquats b on b.noa=a.noa

where (len(@t_noa)=0 or @t_noa = a.noa) and
	  (b.straddr between @t_baddr and @t_eaddr)
union

select '1' gno,'','',a.comp,'','','','',0,'',0,0,'','',0,'',0,''
from tranquat a
left join tranquats b on b.noa=a.noa
where (len(@t_noa)=0 or @t_noa = a.noa) and
	  (b.straddr between @t_baddr and @t_eaddr)
group by comp
order by comp;