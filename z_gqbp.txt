z_gqbp1:--z_gqbp1
	SET QUOTED_IDENTIFIER OFF
	declare @t_accy nvarchar(20)
	declare @t_bgqbno nvarchar(20)
	declare @t_egqbno nvarchar(20)

	set @t_accy = [1]
	set @t_bgqbno = case when '#non'=[2] then '' else [2] end
	set @t_egqbno = case when '#non'=[3] then char(255) else [3] end
	
	z_gqbp1:--z_gqbp1
	SET QUOTED_IDENTIFIER OFF
	declare @t_accy nvarchar(20)
	declare @t_bgqbno nvarchar(20)
	declare @t_egqbno nvarchar(20)

	set @t_accy = [1]
	set @t_bgqbno = case when '#non'=[2] then '' else [2] end
	set @t_egqbno = case when '#non'=[3] then char(255) else [3] end
	
	declare @tmps table(
		gno nvarchar(3),
		noa nvarchar(20),
		gqbno nvarchar(20),
		compno nvarchar(20),
		comp nvarchar(20),
		datea nvarchar(10),
		[money] float,
		cmoney1 nvarchar(20),
		cmoney2  nvarchar(20),
		memo nvarchar(90),
		indate nvarchar(20)
	)
	insert into @tmps 
	select '0',noa,gqbno,tcompno,tcomp,datea,isnull([money],0),'','',case when LEN(comp)>0 then comp else memo end,indate 
	from gqb where (gqbno between @t_bgqbno and @t_egqbno) order by gqbno
	------------------------------------------------------------------------------
	declare @string nvarchar(max)
	set @string="³ü¶L°Ñ¸v¥î³°¬m®Ã¨h"
	
	declare @gqbno nvarchar(20)
	declare @money int
	declare @result nvarchar(max)
	declare @tmp nvarchar(4)
	declare @n int
	declare @cmoney nvarchar(max)
	
	declare cursor_table cursor for
	select gqbno,[money]  from  @tmps
	open cursor_table
	fetch next from cursor_table
	into @gqbno,@money
	while(@@FETCH_STATUS <> -1)
	begin
		set @result = ''
		set @cmoney = CAST(@money as nvarchar)
		set @n=0
		
		if @n=0
		begin
			if(@money=0)
				set @result = '¹s¤¸¾ã'
			else
				set @result = '¤¸¾ã'
		end
		while LEN(@cmoney)>0
		begin
			set @tmp = REVERSE(LEFT(REVERSE(@cmoney),4))
			if @n=1 
				set @result = '¸U'+@result
			if @n=2
				set @result = '»õ'+@result
			set @result  =  substring(@string,CAST(@tmp as int)%10,1)+@result 
			---------------------------------------------------------------------
			if CAST(@tmp as int)=10 or  floor(CAST(@tmp as int)%100/10)!=0
				set @result = '¬B'+@result
			set @result  =  substring(@string,floor((CAST(@tmp as int)%100)/10),1)+@result 
			---------------------------------------------------------------------
			if floor((CAST(@tmp as int)%100)/10)=0 and floor((CAST(@tmp as int)%1000)/100)!=0  and  not(CAST(@tmp as int)%100=0)     
				set @result = '¹s'+@result
			---------------------------------------------------------------------
			if CAST(@tmp as int)=100 or  floor(CAST(@tmp as int)%1000/100)!=0
				set @result = '¨Õ'+@result
			set @result  =  substring(@string,floor((CAST(@tmp as int)%1000)/100),1)+@result 
			---------------------------------------------------------------------
			if  floor((CAST(@tmp as int)%1000)/100)=0 and floor((CAST(@tmp as int)%10000)/1000)!=0 and  not(CAST(@tmp as int)%1000=0)    
				set @result = '¹s'+@result	
			---------------------------------------------------------------------
			if CAST(@tmp as int)=1000 or  floor(CAST(@tmp as int)%10000/1000)!=0
				set @result = '¥a'+@result
			set @result  =  substring(@string,floor((CAST(@tmp as int)%10000)/1000),1)+@result 
			if(LEN(@cmoney)<=4)
			begin
				set  @cmoney = ''
			end
			else
			begin
				set @cmoney = REVERSE(SUBSTRING(REVERSE(@cmoney),5,LEN(@cmoney)-4))
				set @n=@n+1
			end	
		end
		
		update @tmps set cmoney1=reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,@money),1)),4,12))
		,cmoney2=@result  where  gqbno=@gqbno
		
		fetch next from cursor_table
		into @gqbno,@money
	end
	close cursor_table
	deallocate cursor_table
	
	select  case when len(ISNULL(b.nick,''))>0 then b.nick else left(a.comp,4)end aa
	,a.cmoney1 bb,LEFT(a.indate,3) yy,SUBSTRING(a.indate,5,2) mm,RIGHT(a.indate,2) dd,a.* 
	from @tmps a
	left join tgg b on a.compno=b.noa
	order  by  gqbno,gno;
