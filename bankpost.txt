post_media:--產生郵局電子檔
declare @t_noa nvarchar(20)=[1]--單據編號

IF OBJECT_ID('tempdb..##tmp')is not null
BEGIN
   drop table ##tmp
END

create table ##tmp(
	txt nvarchar(1000)
)

insert ##tmp
select '033'+left(isnull(d.account,REPLICATE(' ',7)),7)+REPLICATE(' ',6)+RIGHT(isnull(d.account,REPLICATE(' ',8)),8)
+replace(a.datea,'/','')+left(isnull(c.account,REPLICATE(' ',7)),7)+right(isnull(c.account,REPLICATE(' ',7)),7)
+isnull(left(c.id,10),REPLICATE(' ',10))+right(REPLICATE('0',10)+replace(replace(dbo.getComma(sum(b.total5),2),',',''),'.',''),10)
+REPLICATE(' ',15) txt
from salary a left join salarys b on a.noa=b.noa
left join sss c on b.sno=c.noa left join acomp d on c.cno=d.noa
where a.noa=@t_noa
group by d.account,a.datea,c.account,c.id,b.sno
order by a.datea,b.sno

--產生檔案
declare @string varchar(500)=''
set @string='bcp "SELECT txt FROM ##tmp " queryout "C:\inetpub\wwwroot\htm\htm\PSBP-PAY-NEW.txt" -S"localhost,1799" -U"sa" -P"artsql963" -T -c -t'

EXEC master..xp_cmdshell @string

IF OBJECT_ID('tempdb..##tmp')is not null
BEGIN
   drop table ##tmp
END
;