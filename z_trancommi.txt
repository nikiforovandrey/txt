z_trancommi1:--z_trancommi1
	SET QUOTED_IDENTIFIER OFF
	declare @cmd nvarchar(max)
	declare @t_accy nvarchar(max)
	declare @t_bdate nvarchar(10)
	declare @t_edate nvarchar(10)
	declare @t_btrandate nvarchar(10)
	declare @t_etrandate nvarchar(10)
	declare @t_bsalesno nvarchar(20)
	declare @t_esalesno nvarchar(20)
	declare @t_bcustno nvarchar(20)
	declare @t_ecustno nvarchar(20)
	declare @t_baddrno nvarchar(20)
	declare @t_eaddrno nvarchar(20)
	declare @t_po nvarchar(20)
	
	set @t_accy = '[1]'
	set @t_bdate = case when '#non'=[2] then '' else [2] end
	set @t_edate = case when '#non'=[3] then CHAR(255) else [3] end
	set @t_btrandate = case when '#non'=[4] then '' else [4] end
	set @t_etrandate = case when '#non'=[5] then CHAR(255) else [5] end
	set @t_bsalesno = case when '#non'=[6] then '' else [6] end
	set @t_esalesno = case when '#non'=[7] then CHAR(255) else [7] end
	set @t_bcustno = case when '#non'=[8] then '' else [8] end
	set @t_ecustno = case when '#non'=[9] then CHAR(255) else [9] end
	set @t_baddrno = case when '#non'=[10] then '' else [10] end
	set @t_eaddrno = case when '#non'=[11] then CHAR(255) else [11] end
	set @t_po = case when '#non'=[12] then '' else [12] end
	
	declare @tmp table( 
		gno nvarchar(1), 
		noa nvarchar(30), 
		datea nvarchar(20),
		trandate nvarchar(20), 
		salesno nvarchar(20), 
		sales nvarchar(50), 
		custno nvarchar(20), 
		comp nvarchar(50), 
		addr nvarchar(50), 
		commission float, 
		commission2 float, 
		mount float, 
		total float,
		total2 float
	) 
	
	set @cmd =
	" select '0' gno,a.noa,a.datea,a.trandate,a.salesno,a.sales"+
	" ,a.custno,a.nick,a.straddr,a.commission,a.commission2,a.mount,round(a.commission*a.mount,0),round(a.commission2*a.mount,0)"+
	" from view_trans"+@t_accy+" a"+
	" where (a.commission !=0 or a.commission2!=0)"+
	" and (a.datea between @t_bdate and @t_edate) "+
	" and (a.trandate between @t_btrandate and @t_etrandate) "+
	" and (a.salesno between @t_bsalesno and @t_esalesno) "+
	" and (a.custno between @t_bcustno and @t_ecustno) "+
	" and (a.straddrno between @t_baddrno and @t_eaddrno) "+
	" and (len(@t_po)=0 or @t_po=a.po)"
	
	insert into @tmp 
	execute sp_executesql @cmd,N'@t_bdate nvarchar(10),@t_edate nvarchar(10),@t_btrandate nvarchar(10),@t_etrandate nvarchar(10),@t_bsalesno nvarchar(20),@t_esalesno nvarchar(20),@t_bcustno nvarchar(20),@t_ecustno nvarchar(20),@t_baddrno nvarchar(20),@t_eaddrno nvarchar(20),@t_po nvarchar(20)' 
	,@t_bdate=@t_bdate,@t_edate=@t_edate,@t_btrandate=@t_btrandate,@t_etrandate=@t_etrandate,@t_bsalesno=@t_bsalesno,@t_esalesno=@t_esalesno,@t_bcustno=@t_bcustno,@t_ecustno=@t_ecustno,@t_baddrno=@t_baddrno,@t_eaddrno=@t_eaddrno,@t_po=@t_po
	
	insert into @tmp
	select '1','','','',salesno,'','','',SUM(commission),SUM(commission2),SUM(mount),SUM(mount),SUM(total),SUM(total2) from @tmp where gno='0' group by salesno
	insert into @tmp
	select '2','','','',char(255),'','','',SUM(commission),SUM(commission2),SUM(mount),SUM(mount),SUM(total),SUM(total2) from @tmp where gno='0'
	
	set @cmd=''
	if len(@t_bdate)>0
		set  @cmd  =  '登錄日期：'+@t_bdate+'～'+@t_edate
	if len(@t_btrandate)>0
		set  @cmd  =  '交運日期：'+@t_btrandate+'～'+@t_etrandate
		
	select *
	,@cmd titlea
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,commission),1)),4,12)) cc1
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,commission2),1)),4,12)) cc2
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) tt1
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total2),1)),4,12)) tt2
	from @tmp
	order by salesno,gno,trandate;

z_trancommi2:--z_trancommi2
SET QUOTED_IDENTIFIER OFF
	declare @cmd nvarchar(max)
	declare @t_accy nvarchar(max)
	declare @t_bdate nvarchar(10)
	declare @t_edate nvarchar(10)
	declare @t_btrandate nvarchar(10)
	declare @t_etrandate nvarchar(10)
	declare @t_bsalesno nvarchar(20)
	declare @t_esalesno nvarchar(20)
	declare @t_bcustno nvarchar(20)
	declare @t_ecustno nvarchar(20)
	declare @t_baddrno nvarchar(20)
	declare @t_eaddrno nvarchar(20)
	declare @t_po nvarchar(20)
	
	set @t_accy = '[1]'
	set @t_bdate = case when '#non'=[2] then '' else [2] end
	set @t_edate = case when '#non'=[3] then CHAR(255) else [3] end
	set @t_btrandate = case when '#non'=[4] then '' else [4] end
	set @t_etrandate = case when '#non'=[5] then CHAR(255) else [5] end
	set @t_bsalesno = case when '#non'=[6] then '' else [6] end
	set @t_esalesno = case when '#non'=[7] then CHAR(255) else [7] end
	set @t_bcustno = case when '#non'=[8] then '' else [8] end
	set @t_ecustno = case when '#non'=[9] then CHAR(255) else [9] end
	set @t_baddrno = case when '#non'=[10] then '' else [10] end
	set @t_eaddrno = case when '#non'=[11] then CHAR(255) else [11] end
	set @t_po = case when '#non'=[12] then '' else [12] end
	
	declare @tmp table( 
		gno nvarchar(1), 
		noa nvarchar(30), 
		salesno nvarchar(20), 
		sales nvarchar(50), 
		commission float, 
		commission2 float, 
		mount float, 
		total float,
		total2 float
	) 
	
	set @cmd =
	" select '0' gno,a.salesno,a.sales"+
	" ,a.commission,a.commission2,sum(a.mount),sum(round(a.commission*a.mount,0)),sum(round(a.commission2*a.mount,0))"+
	" from view_trans"+@t_accy+" a"+
	" left join sss b on a.salesno=b.noa"+
	" where (a.commission !=0 or a.commission2!=0)"+
	" and (a.datea between @t_bdate and @t_edate) "+
	" and (a.trandate between @t_btrandate and @t_etrandate) "+
	" and (a.salesno between @t_bsalesno and @t_esalesno) "+
	" and (a.custno between @t_bcustno and @t_ecustno) "+
	" and (a.straddrno between @t_baddrno and @t_eaddrno) "+
	" and (len(@t_po)=0 or @t_po=a.po)"
	
	insert into @tmp 
	execute sp_executesql @cmd,N'@t_bdate nvarchar(10),@t_edate nvarchar(10),@t_btrandate nvarchar(10),@t_etrandate nvarchar(10),@t_bsalesno nvarchar(20),@t_esalesno nvarchar(20),@t_bcustno nvarchar(20),@t_ecustno nvarchar(20),@t_baddrno nvarchar(20),@t_eaddrno nvarchar(20),@t_po nvarchar(20)' 
	,@t_bdate=@t_bdate,@t_edate=@t_edate,@t_btrandate=@t_btrandate,@t_etrandate=@t_etrandate,@t_bsalesno=@t_bsalesno,@t_esalesno=@t_esalesno,@t_bcustno=@t_bcustno,@t_ecustno=@t_ecustno,@t_baddrno=@t_baddrno,@t_eaddrno=@t_eaddrno,@t_po=@t_po
	
	insert into @tmp
	select '1','','','',salesno,'','','',SUM(commission),SUM(commission2),SUM(mount),SUM(mount),SUM(total),SUM(total2) from @tmp where gno='0' group by salesno
	insert into @tmp
	select '2','','','',char(255),'','','',SUM(commission),SUM(commission2),SUM(mount),SUM(mount),SUM(total),SUM(total2) from @tmp where gno='0'
	
	set @cmd=''
	if len(@t_bdate)>0
		set  @cmd  =  '登錄日期：'+@t_bdate+'～'+@t_edate
	if len(@t_btrandate)>0
		set  @cmd  =  '交運日期：'+@t_btrandate+'～'+@t_etrandate
		
	select *
	,@cmd titlea
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,commission),1)),4,12)) cc1
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,commission2),1)),4,12)) cc2
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) tt1
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total2),1)),4,12)) tt2
	from @tmp
	order by salesno,gno,trandate;