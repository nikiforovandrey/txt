z_salvacause1:--z_salvacause1
declare @t_bdate nvarchar(10)
declare @t_edate nvarchar(10)
declare @t_bsssno nvarchar(20)
declare @t_esssno nvarchar(20)
set @t_bdate = case when '#non'=[1] then '' else [1] end
set @t_edate = case when '#non'=[2] then char(255) else [2] end
set @t_bsssno = case when '#non'=[3] then '' else [3] end
set @t_esssno = case when '#non'=[4] then char(255) else [4] end
select '0' gno,* ,@t_bdate xbdate,@t_edate xedate
from salvacause
where (bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate) and (sssno between @t_bsssno and @t_esssno);
-------------------------------------------------------------------------------------------------------------------------------
z_salvacause2:--z_salvacause2
declare @t_bdate nvarchar(10)
declare @t_edate nvarchar(10)
declare @t_bsssno nvarchar(20)
declare @t_esssno nvarchar(20)
set @t_bdate = case when '#non'=[1] then '' else [1] end
set @t_edate = case when '#non'=[2] then char(255) else [2] end
set @t_bsssno = case when '#non'=[3] then '' else [3] end
set @t_esssno = case when '#non'=[4] then char(255) else [4] end

declare @tmp table(
		gno nvarchar(1),
		sssno nvarchar(20),
		namea nvarchar(10),
		person float,
		sick float,
		leave float,
		marr float,
		bereave float,
		spec float,
		offic float,
		late float,
		early float
)
insert into @tmp 
select '0',noa,namea,0,0,0,0,0,0,0,0,0
from sss
where noa between @t_bsssno and @t_esssno

declare @sssno nvarchar(20)
declare @count float

--病假
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='病假'
and ((bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set sick=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table

--曠工
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='曠工'
and ((bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set leave=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table

--事假
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='事假'
and ((bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set person=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table

--婚假
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='婚假'
and ((bdate between '101/01/01' and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set marr=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table

--喪假
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='喪假'
and ((bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set bereave=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table

---特休
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='特休'
and ((bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set spec=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table

---公假
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='公假'
and ((bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set offic=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table

---遲到
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='遲到'
and ((bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set late=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table

---早退
declare cursor_table cursor for
select sssno,SUM(hr_used)
from salvacause
where left(hname,2)='早退'
and ((bdate between @t_bdate and @t_edate) and (edate between @t_bdate and @t_edate))
group by sssno
open cursor_table
fetch next from cursor_table
into @sssno,@count
while(@@FETCH_STATUS <> -1)
begin

update @tmp
set early=@count
where sssno=@sssno

fetch next from cursor_table
into @sssno,@count
end
close cursor_table
deallocate cursor_table


insert into @tmp 
select '1','','',sum(person),sum(sick),sum(leave),sum(marr),sum(bereave),sum(spec),sum(offic),sum(late),sum(early)
from @tmp

select * from @tmp;