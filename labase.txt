upload_salary:--upload_salary
--更新提繳金額
declare @t_worker nvarchar(20)
set @t_worker = [1]

update a
set he_comp=b.he_comp
,he_person=b.he_person*case when isnull(a.mount,0)>3 then 4 else isnull(a.mount,0)+1 end
,la_comp=case when isnull(isforeign,0)=0 then c.lcomp else c.flcomp end
,la_person=case when isnull(isforeign,0)=0 then c.lself else c.flself end
,re_comp=d.pcomp
,worker2=@t_worker
--,disaster=round((a.sa_labor*insur_fund/100),0)+round((a.sa_labor*insur_disaster/100),0)
from labase a
outer apply (select * from labhealths where noa=(select MAX(noa) from labhealth) and a.sa_health between salary1 and salary2 )b
outer apply (select * from labsals where noa=(select MAX(noa) from labsal) and a.sa_labor between salary1 and salary2 )c
outer apply (select * from labretires where noa=(select MAX(noa) from labretire) and a.sa_retire between salary1 and salary2 )d
;
-------------------------------------------------------------------------------------------------------------------------------------------------------