z_welfare1:--z_welfare1
declare @t_bdate nvarchar(10)
declare @t_edate nvarchar(10)
set @t_bdate = case when '#non'=[1] then '' else [1] end
set @t_edate = case when '#non'=[2] then char(255) else [2] end
declare @tmp table(
	gno nvarchar(1),
	noa nvarchar(20),
	datea nvarchar(10),
	sssno nvarchar(20),
	namea nvarchar(50),
	income int,
	pay int,
	total float
)
insert into @tmp
select '0','1','','','期初金額',isnull(sum(cast(income as float)),0),isnull(sum(cast(pay as float)),0),isnull(sum(cast(income as float))-sum(cast(pay as float)),0) from welfare
where (datea< @t_bdate)
insert into @tmp
select '0',noa,datea,sssno,namea,isnull(income,0),isnull(pay,0),isnull(sum(cast(income as float))-sum(cast(pay as float)),0) from welfare
where (datea between @t_bdate and @t_edate)
group by noa,datea,sssno,namea,income,pay
insert into @tmp
select '1','2','','','期末金額',sum(cast(income as float)),sum(cast(pay as float)),(sum(cast(income as float))-sum(cast(pay as float))) from @tmp
select
gno,noa,datea,sssno,namea,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,isnull(income,0)),1)),4,12)) income,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,isnull(pay,0)),1)),4,12)) pay,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,isnull(total,0)),1)),4,12)) total
from @tmp order by gno,datea;
--*****************************************************************************************************
z_welfare2:--z_welfare2
declare @t_bdate nvarchar(10)
declare @t_edate nvarchar(10)
set @t_bdate = case when '#non'=[1] then '' else [1] end
set @t_edate = case when '#non'=[2] then char(255) else [2] end
declare @tmp table(
	gno nvarchar(1),
	noa nvarchar(20),
	datea nvarchar(10),
	income nvarchar(15),
	pay nvarchar(15),
	total nvarchar(15),
	inpaymemo nvarchar(200)
)
insert into @tmp
	select '2' gno,noa,datea,income,pay,'0',inpaymemo from welfare where (datea between @t_bdate and @t_edate)
insert into @tmp
select '0' gno,'','',sum(cast(income as int)),sum(cast(pay as int)),(sum(cast(income as int)) - sum(cast(pay as int))),inpaymemo from @tmp group by inpaymemo
insert into @tmp
select '1' gno,'','',sum(cast(income as int)),sum(cast(pay as int)),(sum(cast(income as int)) - sum(cast(pay as int))),'' from @tmp where (gno = 0) group by gno
select gno,inpaymemo,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,isnull(income,0)),1)),4,12)) income,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,isnull(pay,0)),1)),4,12)) pay,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,isnull(total,0)),1)),4,12)) total
from @tmp where (gno != 2);