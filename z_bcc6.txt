z_bcc6:--z_bcc6
	declare @t_year nvarchar(10)
	declare @t_bbccno nvarchar(20)
	declare @t_ebccno nvarchar(20)
	declare @t_btggno nvarchar(20)
	declare @t_etggno nvarchar(20)
	set @t_year = case when '#non'=[1] then '' else [1] end
	set @t_bbccno = case when '#non'=[2] then '' else [2] end
	set @t_ebccno = case when '#non'=[3] then char(255) else [3] end
	set @t_btggno = case when '#non'=[4] then '' else [4] end
	set @t_etggno = case when '#non'=[5] then char(255) else [5] end
	--*****************************************************************************************	
	
declare @t_result table(
		tggno nvarchar(10),
		tgg nvarchar(40),
		datea nvarchar(10),
		bccno nvarchar(20),
		bccname nvarchar(50),
		price decimal (14,2)
)
insert into @t_result
select a.tggno,a.tgg,left(a.datea,6) datea,b.bccno,b.bccname,price
from bccin a left join bccins b on a.noa=b.noa
where datea between @t_year+'/01/01' and @t_year+'/12/31' and (tggno between @t_btggno and @t_etggno) and (b.bccno between @t_bbccno and @t_ebccno)
order by tggno,b.bccno,datea

declare @result table(
		gno nvarchar(1),
		tggno nvarchar(10),
		tgg nvarchar(40),
		datea nvarchar(10),
		bccno nvarchar(20),
		bccname nvarchar(50),	
		Jan decimal (14,2),
		Feb decimal (14,2),
		Mar decimal (14,2),
		Apr decimal (14,2),
		May decimal (14,2),
		Jun decimal (14,2),
		Jul decimal (14,2),
		Aug decimal (14,2),
		Sep decimal (14,2),
		Oct decimal (14,2),
		Nov decimal (14,2),
		Dec decimal (14,2)
)

declare @gno nvarchar(1)
declare @datea nvarchar(6)
declare @tggno nvarchar(10)
declare @tgg nvarchar(40)
declare @bccno nvarchar(20)
declare @bccname nvarchar(50)
declare @price decimal (14,2)
declare @t_tggno nvarchar(10)
declare @t_bccno nvarchar(20)
set @t_tggno = '#xxxx#xxxx'
set @t_bccno = '#xxxx#xxxx'
declare bcc_table cursor for
select tggno,tgg,datea,bccno,bccname,price from @t_result
open bcc_table
fetch next from bcc_table
into @tggno,@tgg,@datea,@bccno,@bccname,@price
while(@@FETCH_STATUS <> -1)
begin
	if(@tggno!=@t_tggno or @t_bccno!= @bccno)
	begin
		if(RIGHT(@datea,2)='01')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,@price,null,null,null,null,null,null,null,null,null,null,null
		end
		else if(RIGHT(@datea,2)='02')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,@price,null,null,null,null,null,null,null,null,null,null
		end
		else if(RIGHT(@datea,2)='03')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,@price,null,null,null,null,null,null,null,null,null
		end
		else if(RIGHT(@datea,2)='04')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,@price,null,null,null,null,null,null,null,null
		end
		else if(RIGHT(@datea,2)='05')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,null,@price,null,null,null,null,null,null,null
		end
		else if(RIGHT(@datea,2)='06')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,null,null,@price,null,null,null,null,null,null
		end
		else if(RIGHT(@datea,2)='07')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,null,null,null,@price,null,null,null,null,null
		end
		else if(RIGHT(@datea,2)='08')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,null,null,null,null,@price,null,null,null,null
		end
		else if(RIGHT(@datea,2)='09')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,null,null,null,null,null,@price,null,null,null
		end
		else if(RIGHT(@datea,2)='10')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,null,null,null,null,null,null,@price,null,null
		end
		else if(RIGHT(@datea,2)='11')
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,null,null,null,null,null,null,null,@price,null
		end
		else
		begin
			insert into @result
			select '0',@tggno,@tgg,@datea,@bccno,@bccname,null,null,null,null,null,null,null,null,null,null,null,@price
		end	
	end
	else
	begin
		if(RIGHT(@datea,2)='01')
		begin
			update @result 
			set Jan=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='02')
		begin
			update @result 
			set Feb=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='03')
		begin
			update @result 
			set Mar=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='04')
		begin
			update @result 
			set Apr=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='05')
		begin
			update @result 
			set May=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='06')
		begin
			update @result 
			set Jun=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='07')
		begin
			update @result 
			set Jul=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='08')
		begin
			update @result 
			set Aug=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='09')
		begin
			update @result 
			set Sep=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='10')
		begin
			update @result 
			set Oct=@price
			where tggno=@tggno and bccno=@bccno
		end
		else if(RIGHT(@datea,2)='11')
		begin
			update @result 
			set Nov=@price
			where tggno=@tggno and bccno=@bccno
		end
		else
		begin
			update @result 
			set Dec=@price
			where tggno=@tggno and bccno=@bccno
		end
	end
	
	set @t_tggno = @tggno
	set @t_bccno = @bccno
	
	fetch next from bcc_table
	into @tggno,@tgg,@datea,@bccno,@bccname,@price
end
close bcc_table
deallocate bcc_table

select *
from @result;