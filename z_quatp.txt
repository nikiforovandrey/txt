z_quatp1:--z_quatp1
declare @t_bdate nvarchar(20)
declare @t_edate nvarchar(20)
declare @t_noa nvarchar(30)
set @t_bdate = case when '#non' = [2] then '' else [2] end
set @t_edate = case when '#non' = [3] then CHAR(255) else [3] end
set @t_noa = case when '#non' = [4] then '' else [4] end
declare @tmp table(
	gno nvarchar(1),
	noa nvarchar(30),
	comp nvarchar(90),
	tel nvarchar(30),
	fax nvarchar(30),
	addra nvarchar(max),
	addrb nvarchar(max),
	datea nvarchar(10),
	odate nvarchar(10),
	taxtype nvarchar(20),
	coin nvarchar(10),
	floata float,
	paytype nvarchar(20),
	trantype nvarchar(20),
	productno nvarchar(30),
	products nvarchar(90),
	size nvarchar(100),
	weight float,
	mount float,
	price float,
	unit nvarchar(10),
	money float,
	memo nvarchar(max)
)
insert into @tmp
	select
		'0',b.noa,b.comp,b.tel,b.fax,b.addr,b.addr2,b.datea,b.odate,
		(case when b.taxtype = 1 then '應稅'
		when b.taxtype = 2 then '零稅率'
		when b.taxtype = 3 then '內含'
		when b.taxtype = 4 then '免稅'
		when b.taxtype = 5 then '自訂'
		when b.taxtype = 6 then '作廢' end) taxtype,
		b.coin,b.floata,b.paytype,b.trantype,
		a.productno,a.product,
		cast(a.dime as nvarchar) + ' x ' + cast(a.width as nvarchar) + ' x ' + cast(a.lengthb as nvarchar) size,
		a.weight,a.mount,a.price,a.unit,a.total,a.memo
	from quats[1] a
	left join quat[1] b on a.noa = b.noa
	where b.datea between @t_bdate and @t_edate and (len(@t_noa) = 0 or b.noa = @t_noa)
insert into @tmp(gno,noa)
	select '1',noa from @tmp group by noa
select
	gno,noa,comp,tel,fax,addra,addrb,datea,odate,taxtype,coin,floata,paytype,trantype,productno,products,size,
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,weight),1)),4,12)) weight,
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,mount),1)),4,12)) mount,
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,price),1)),4,12)) price,unit,
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,money),1)),4,12)) money,memo
from @tmp order by noa,gno;