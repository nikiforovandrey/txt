z_gift1:--z_gift1
declare @t_bdate nvarchar(20)
declare @t_edate nvarchar(20)
declare @t_tsendmemo nvarchar(20)
set @t_bdate = case when '#non' = [1] then '' else [1] end
set @t_edate = case when '#non' = [2] then CHAR(255) else [2] end
set @t_tsendmemo = case when '#non' = [3] then '' else [3] end
declare @tmp table(
		gno nvarchar(1),
		n int identity,
		nick nvarchar(20),
		comp nvarchar(50),
		tel nvarchar(50),
		addr nvarchar(90),
		product nvarchar(50),
		mount float,
		chg float,
		sales nvarchar(20),
		memo nvarchar(max),
		acomp2 nvarchar(50),
		[message] nvarchar(max)
)
insert into @tmp
select '0' gno,case when len(d.nick)>0 then d.nick else left(c.comp,4) end,
c.comp+c.namea+c.job,c.tel,c.addr_cust,a.gift,b.mount,b.money,a.sales,b.memo,a.acomp2,a.message
from giftsend a
left join giftsends b on a.noa = b.noa
left join giftcust c on c.noa = b.custno
left join cust d on c.custno = d.noa
where (a.senddate between @t_bdate and @t_edate) and
(len(@t_tsendmemo) = 0 or @t_tsendmemo = a.sendmemo)

select gno,n,nick,comp,tel,addr,product,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,mount),1)),4,12)) mount,
reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,chg),1)),4,12)) chg,
sales,memo,acomp2,message
from @tmp;
