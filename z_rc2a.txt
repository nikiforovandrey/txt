z_rc2a4:--z_rc2a4
	declare @t_bdate nvarchar(10)
	declare @t_edate nvarchar(10)
	declare @t_bmon nvarchar(7)
	declare @t_emon nvarchar(7)
	declare @t_btggno nvarchar(20)
	declare @t_etggno nvarchar(20)
	declare @t_bproductno nvarchar(30)
	declare @t_eproductno nvarchar(30)
	set @t_bdate = case when '#non'=[1] then '' else [1] end
	set @t_edate = case when '#non'=[2] then char(255) else [2] end
	set @t_bmon = case when '#non'=[3] then '' else [3] end
	set @t_emon = case when '#non'=[4] then char(255) else [4] end
	set @t_btggno = case when '#non'=[5] then '' else [5] end
	set @t_etggno = case when '#non'=[6] then char(255) else [6] end
	set @t_bproductno = case when '#non'=[7] then '' else [7] end
	set @t_eproductno = case when '#non'=[8] then char(255) else [8] end
	--*****************************************************************************************	
	declare @result table(
		gno nvarchar(1),
		noa nvarchar(15),
		noq nvarchar(3),
		typea nvarchar(4),
		datea nvarchar(10),
		mon nvarchar(7),
		tggno nvarchar(20),
		comp nvarchar(40),
		pno nvarchar(30),
		pname nvarchar(40),
		unit nvarchar(8),
		mount decimal(16,2),
		weight decimal(16,2),
		price decimal(16,2),
		total decimal(18,0)
		primary key (pno,gno,datea,noa,noq) 
	)
	
	insert into @result
	select '0' gno,b.noa,b.noq,case left(a.noa,1) when ' ' then '退' else '進' end typea,
	       a.datea,a.mon,a.tggno,a.comp,b.productno pno,b.product pname,b.unit,b.mount,0 weight,
	       b.price,b.money
	from rc2as b
	left join rc2a a on a.noa=b.noa
	where (a.datea between @t_bdate and @t_edate) and (a.mon between @t_bmon and @t_emon) and 
	      (a.tggno between @t_btggno and @t_etggno) and (b.productno between @t_bproductno and @t_eproductno)
	order by pno,gno,a.datea,a.noa,b.noq
	--*****************************************************************************************	
	declare @pno nvarchar(30)
	declare @typea nvarchar(10)
	declare @datea nvarchar(10)
	declare @mount decimal(18,2)
	declare @weight decimal(18,2)
	declare @total decimal(18,2)
	
	declare @t_pno nvarchar(30)
	declare @t_totmount decimal(18,2)
	declare @t_totweight decimal(18,2)
	declare @t_tottotal decimal(18,2)
	declare @t_n int
	set @t_pno = '@#S(DJ#SH!@'
	set @t_totmount = 0
	set @t_totweight = 0
	set @t_tottotal = 0
	
	declare cursor_table cursor for
	select pno,typea,datea,mount,weight,total from @result
	open cursor_table
	fetch next from cursor_table
	into @pno,@typea,@datea,@mount,@weight,@total
	while(@@FETCH_STATUS <> -1)
	begin
		set @t_n = case @typea when '退' then -1 else 1 end
		if @t_pno!=@pno and @t_pno!='@#S(DJ#SH!@'
		begin
			insert into @result
			select '1' gno,'' noa,'' noq,'小計' typea,'' datea,'' mon,'' tggno,'' comp,@t_pno pno,'' pname,
			       '' unit,@t_totmount mount,@t_totweight weight,0 price,@t_tottotal total
		end
		if @t_pno!=@pno
		begin
			set @t_pno = @pno
			set @t_totmount =  @mount*@t_n
			set @t_totweight = @weight*@t_n
			set @t_tottotal = @total*@t_n
		end
		else
		begin
			set @t_totmount = @t_totmount + @mount*@t_n
			set @t_totweight = @t_totweight + @weight*@t_n
			set @t_tottotal = @t_tottotal + @total*@t_n
		end
		fetch next from cursor_table
		into @pno,@typea,@datea,@mount,@weight,@total
	end
	close cursor_table
	deallocate cursor_table
	if @t_pno!='@#S(DJ#SH!@'
	begin
		insert into @result
		select '1' gno,'' noa,'' noq,'小計' typea,'' datea,'' mon,'' tggno,'' comp,@t_pno pno,'' pname,
		       '' unit,@t_totmount mount,@t_totweight weight,0 price,@t_tottotal total
	end
	--*****************************************************************************************	
	select gno,noa,noq,typea,datea,mon,tggno,LEFT(comp,4) comp,pno,pname,unit
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,mount),1)),4,12)) mount
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,weight),1)),0,12)) weight
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,price),1)),0,12)) price
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) total
	,'rc2a?noa=$noa?' qhref
	from @result order by pno,gno,datea,noa,noq;
----------------------------------------------------------------------------------------------------------------------------------------------
z_rc2a7:--z_rc2a7
	declare @t_bdate nvarchar(10)
	declare @t_edate nvarchar(10)
	declare @t_bmon nvarchar(7)
	declare @t_emon nvarchar(7)
	declare @t_btggno nvarchar(20)
	declare @t_etggno nvarchar(20)
	declare @t_bproductno nvarchar(30)
	declare @t_eproductno nvarchar(30)
	set @t_bdate = case when '#non'=[1] then '' else [1] end
	set @t_edate = case when '#non'=[2] then char(255) else [2] end
	set @t_bmon = case when '#non'=[3] then '' else [3] end
	set @t_emon = case when '#non'=[4] then char(255) else [4] end
	set @t_btggno = case when '#non'=[5] then '' else [5] end
	set @t_etggno = case when '#non'=[6] then char(255) else [6] end
	set @t_bproductno = case when '#non'=[7] then '' else [7] end
	set @t_eproductno = case when '#non'=[8] then char(255) else [8] end
	--*****************************************************************************************	
	declare @result table(
		gno nvarchar(1),
		noa nvarchar(15),
		nob nvarchar(15),
		noq nvarchar(3),
		typea nvarchar(4),
		datea nvarchar(10),
		mon nvarchar(7),
		tggno nvarchar(20),
		comp nvarchar(40),
		money decimal(16,2),
		tax decimal(16,2),
		total decimal(18,2),
		pno nvarchar(30),
		pname nvarchar(40),
		unit nvarchar(8),
		pmount decimal(16,2),
		pweight decimal(16,2),
		price decimal(16,2),
		ptotal decimal(18,0),
		pcount int
		primary key (gno,noa,noq) 
	)
	
	insert into @result
	select '0' gno,b.noa,b.noa,b.noq,case left(a.noa,1) when ' ' then '退' else '進' end typea,
	       a.datea,a.mon,a.tggno,a.comp,a.money,a.tax,a.total,b.productno pno,b.product pname,
	       b.unit,b.mount pmount,0 pweight,b.price,b.money ptotal, 0 pcount
	from rc2as b
	left join rc2a a on a.noa=b.noa
	where (a.datea between @t_bdate and @t_edate) and (a.mon between @t_bmon and @t_emon) and 
	      (a.tggno between @t_btggno and @t_etggno) and (b.productno between @t_bproductno and @t_eproductno)
	order by gno,a.noa,b.noq
	--*****************************************************************************************	
	declare @noa nvarchar(15)
	declare @typea nvarchar(10)
	declare @money decimal(18,2)
	declare @tax decimal(18,2)
	declare @total decimal(18,2)
	declare @pmount decimal(18,2)
	declare @pweight decimal(18,2)
	declare @ptotal decimal(18,2)
	
	declare @t_noa nvarchar(15)
	declare @t_money decimal(18,2)
	declare @t_tax decimal(18,2)
	declare @t_total decimal(18,2)
	declare @t_pmount decimal(18,2)
	declare @t_pweight decimal(18,2)
	declare @t_ptotal decimal(18,2)
	declare @t_pcount int
	declare @t_n int
	set @t_noa = '@#S(DJ#SH!@'
	set @t_money = 0
	set @t_tax = 0
	set @t_total = 0
	set @t_pmount = 0
	set @t_pweight = 0
	set @t_ptotal = 0
	set @t_pcount = 0
	declare cursor_table cursor for
	select noa,typea,money,tax,total,pmount,pweight,ptotal from @result
	open cursor_table
	fetch next from cursor_table
	into @noa,@typea,@money,@tax,@total,@pmount,@pweight,@ptotal
	while(@@FETCH_STATUS <> -1)
	begin
		set @t_n = case when @typea='退' then -1 else 1 end
		if @t_noa!=@noa
		begin
			set @t_noa = @noa
			set @t_money = @t_money + @money*@t_n
			set @t_tax = @t_tax + @tax*@t_n
			set @t_total = @t_total + @total*@t_n
			set @t_pcount = @t_pcount + 1
		end
		else
		begin
			update @result
		   	set nob=''
		 	where current of cursor_table
		end
		set @t_pmount = @t_pmount + @pmount*@t_n
		set @t_pweight = @t_pweight + @pweight*@t_n
		set @t_ptotal = @t_ptotal + @ptotal*@t_n
		
		fetch next from cursor_table
		into @noa,@typea,@money,@tax,@total,@pmount,@pweight,@ptotal
	end
	close cursor_table
	deallocate cursor_table
	
	insert into @result
	select '1' gno,'' noa,''nob,'' noq,'小計' typea,'' datea,'' mon,'' tggno,'' comp,@t_money money,
	       @t_tax tax,@t_total total,'' pno,'' pname,'' unit,@t_pmount pmount,@t_pweight pweight,
	       0 price,@t_ptotal ptotal,@t_pcount pcount
	
	--*****************************************************************************************	
	select gno,noa,nob,noq,typea,datea,mon,tggno,LEFT(comp,6) comp
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,money),1)),4,12)) money
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,tax),1)),4,12)) tax
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) total
	,pno,pname,unit
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,pmount),1)),4,12)) pmount
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,pweight),1)),0,12)) pweight
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,price),1)),0,12)) price
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,ptotal),1)),4,12)) ptotal
	,pcount,'rc2a?noa=$nob?' qhref
	from @result order by gno,noa,noq;
-------------------------------------------------------------------------------------------------------------------------------------
z_rc2a8:--z_rc2a8
	declare @t_bdate nvarchar(10)
	declare @t_edate nvarchar(10)
	declare @t_bmon nvarchar(7)
	declare @t_emon nvarchar(7)
	declare @t_btggno nvarchar(20)
	declare @t_etggno nvarchar(20)
	declare @t_bproductno nvarchar(30)
	declare @t_eproductno nvarchar(30)
	set @t_bdate = case when '#non'=[1] then '' else [1] end
	set @t_edate = case when '#non'=[2] then char(255) else [2] end
	set @t_bmon = case when '#non'=[3] then '' else [3] end
	set @t_emon = case when '#non'=[4] then char(255) else [4] end
	set @t_btggno = case when '#non'=[5] then '' else [5] end
	set @t_etggno = case when '#non'=[6] then char(255) else [6] end
	set @t_bproductno = case when '#non'=[7] then '' else [7] end
	set @t_eproductno = case when '#non'=[8] then char(255) else [8] end
	--*****************************************************************************************	
	declare @result table(
		gno nvarchar(1),
		noa nvarchar(15),
		nob nvarchar(15),
		noq nvarchar(3),
		typea nvarchar(4),
		datea nvarchar(10),
		mon nvarchar(7),
		tggno nvarchar(20),
		comp nvarchar(40),
		money decimal(16,2),
		tax decimal(16,2),
		total decimal(18,2),
		pno nvarchar(30),
		pname nvarchar(40),
		unit nvarchar(8),
		pmount decimal(16,2),
		pweight decimal(16,2),
		price decimal(16,2),
		ptotal decimal(18,0),
		pcount int
		primary key (mon,gno,datea,noa,noq) 
	)
	
	insert into @result
	select '0' gno,b.noa,b.noa,b.noq,case left(a.noa,1) when ' ' then '退' else '進' end typea,
	       a.datea,a.mon,a.tggno,a.comp,a.money,a.tax,a.total,b.productno pno,b.product pname,
	       b.unit,b.mount pmount,0 pweight,b.price,b.money ptotal, 0 pcount
	from rc2as b
	left join rc2a a on a.noa=b.noa
	where (a.datea between @t_bdate and @t_edate) and (a.mon between @t_bmon and @t_emon) and 
	      (a.tggno between @t_btggno and @t_etggno) and (b.productno between @t_bproductno and @t_eproductno)
	order by a.mon,gno,a.datea,a.noa,b.noq
	--*****************************************************************************************	
	declare @noa nvarchar(15)
	declare @mon nvarchar(7)
	declare @typea nvarchar(10)
	declare @money decimal(18,2)
	declare @tax decimal(18,2)
	declare @total decimal(18,2)
	declare @pmount decimal(18,2)
	declare @pweight decimal(18,2)
	declare @ptotal decimal(18,2)
	
	declare @t_noa nvarchar(15)
	declare @t_mon nvarchar(7)
	declare @t_money decimal(18,2)
	declare @t_tax decimal(18,2)
	declare @t_total decimal(18,2)
	declare @t_pmount decimal(18,2)
	declare @t_pweight decimal(18,2)
	declare @t_ptotal decimal(18,2)
	declare @t_pcount int
	declare @t_n int
	set @t_noa=''
	set @t_mon = '@W#$SSW'
	set @t_money = 0
	set @t_tax = 0
	set @t_total = 0
	set @t_pmount = 0
	set @t_pweight = 0
	set @t_ptotal = 0
	set @t_pcount = 0
	declare cursor_table cursor for
	select noa,mon,typea,money,tax,total,pmount,pweight,ptotal from @result
	open cursor_table
	fetch next from cursor_table
	into @noa,@mon,@typea,@money,@tax,@total,@pmount,@pweight,@ptotal
	while(@@FETCH_STATUS <> -1)
	begin
		if @t_mon!=@mon and @t_mon != '@W#$SSW'
		begin
			insert into @result
			select '1' gno,'' noa,''nob,'' noq,'小計' typea,'' datea,@t_mon mon,'' tggno,'' comp,@t_money money,
			       @t_tax tax,@t_total total,'' pno,'' pname,'' unit,@t_pmount pmount,@t_pweight pweight,
			       0 price,@t_ptotal ptotal,@t_pcount pcount
	    end   
		set @t_n = case when @typea='退' then -1 else 1 end
		if @t_mon!=@mon
		begin
			set @t_mon = @mon
			set @t_money = @money*@t_n
			set @t_tax = @tax*@t_n
			set @t_total = @total*@t_n
			set @t_pcount = @t_pcount + 1
			set @t_pmount = @pmount*@t_n
			set @t_pweight = @pweight*@t_n
			set @t_ptotal = @ptotal*@t_n
		end
		else
		begin
			set @t_pmount = @t_pmount + @pmount*@t_n
			set @t_pweight = @t_pweight + @pweight*@t_n
			set @t_ptotal = @t_ptotal + @ptotal*@t_n
		end
		
		if @t_noa!=@noa
		begin
			set @t_noa = @noa
		end
		else
		begin
			update @result
		   	set nob=''
		 	where current of cursor_table
		end
		
		fetch next from cursor_table
		into @noa,@mon,@typea,@money,@tax,@total,@pmount,@pweight,@ptotal
	end
	close cursor_table
	deallocate cursor_table
	
	if @t_mon != '@W#$SSW'
	begin
		insert into @result
		select '1' gno,'' noa,''nob,'' noq,'小計' typea,'' datea,@t_mon mon,'' tggno,'' comp,@t_money money,
		       @t_tax tax,@t_total total,'' pno,'' pname,'' unit,@t_pmount pmount,@t_pweight pweight,
		       0 price,@t_ptotal ptotal,@t_pcount pcount
    end   
	
	--*****************************************************************************************	
	select gno,noa,nob,noq,typea,datea,mon,tggno,LEFT(comp,6) comp,pno,pname,unit,pcount
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,money),1)),4,12)) money
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,tax),1)),4,12)) tax
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) total
	,pno,pname,unit
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,pmount),1)),4,12)) pmount
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,pweight),1)),0,12)) pweight
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,price),1)),0,12)) price
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,ptotal),1)),4,12)) ptotal
	
	,'rc2a?noa=$nob?' qhref
	from @result order by mon,gno,datea,noa,noq;
----------------------------------------------------------------------------------------------------------------------------------------------------------
z_rc2a9:--z_rc2a9
	declare @t_bdate nvarchar(10)
	declare @t_edate nvarchar(10)
	declare @t_bmon nvarchar(7)
	declare @t_emon nvarchar(7)
	declare @t_btggno nvarchar(20)
	declare @t_etggno nvarchar(20)
	declare @t_bproductno nvarchar(30)
	declare @t_eproductno nvarchar(30)
	set @t_bdate = case when '#non'=[1] then '' else [1] end
	set @t_edate = case when '#non'=[2] then char(255) else [2] end
	set @t_bmon = case when '#non'=[3] then '' else [3] end
	set @t_emon = case when '#non'=[4] then char(255) else [4] end
	set @t_btggno = case when '#non'=[5] then '' else [5] end
	set @t_etggno = case when '#non'=[6] then char(255) else [6] end
	set @t_bproductno = case when '#non'=[7] then '' else [7] end
	set @t_eproductno = case when '#non'=[8] then char(255) else [8] end
	--*****************************************************************************************	
	declare @result table(
		gno nvarchar(1),
		noa nvarchar(15),
		noq nvarchar(3),
		typea nvarchar(4),
		datea nvarchar(10),
		mon nvarchar(7),
		tggno nvarchar(20),
		comp nvarchar(40),
		pno nvarchar(30),
		pname nvarchar(40),
		unit nvarchar(8),
		mount decimal(16,2),
		weight decimal(16,2),
		price decimal(16,2),
		total decimal(18,0)
		primary key (tggno,gno,pno,datea,noa,noq) 
	)
	
	insert into @result
	select '0' gno,b.noa,b.noq,case left(a.noa,1) when ' ' then '退' else '進' end typea,
	       a.datea,a.mon,a.tggno,a.comp,b.productno pno,b.product pname,b.unit,b.mount,0 weight,
	       b.price,b.money
	from rc2as b
	left join rc2a a on a.noa=b.noa
	where (a.datea between @t_bdate and @t_edate) and (a.mon between @t_bmon and @t_emon) and 
	      (a.tggno between @t_btggno and @t_etggno) and (b.productno between @t_bproductno and @t_eproductno)
	order by a.tggno,gno,pno,a.datea,a.noa,b.noq
	--*****************************************************************************************	
	declare @tggno nvarchar(20)
	declare @typea nvarchar(10)
	declare @datea nvarchar(10)
	declare @mount decimal(18,2)
	declare @weight decimal(18,2)
	declare @total decimal(18,2)
	
	declare @t_tggno nvarchar(20)
	declare @t_totmount decimal(18,2)
	declare @t_totweight decimal(18,2)
	declare @t_tottotal decimal(18,2)
	declare @t_n int
	set @t_tggno = '@#S(DJ#SH!@'
	set @t_totmount = 0
	set @t_totweight = 0
	set @t_tottotal = 0
	
	declare cursor_table cursor for
	select tggno,typea,datea,mount,weight,total from @result
	open cursor_table
	fetch next from cursor_table
	into @tggno,@typea,@datea,@mount,@weight,@total
	while(@@FETCH_STATUS <> -1)
	begin
		set @t_n = case @typea when '退' then -1 else 1 end
		if @t_tggno!=@tggno and @t_tggno!='@#S(DJ#SH!@'
		begin
			insert into @result
			select '1' gno,'' noa,'' noq,'小計' typea,'' datea,'' mon,@t_tggno tggno,'' comp,'' pno,'' pname,
			       '' unit,@t_totmount mount,@t_totweight weight,0 price,@t_tottotal total
		end
		if @t_tggno!=@tggno
		begin
			set @t_tggno = @tggno
			set @t_totmount =  @mount*@t_n
			set @t_totweight = @weight*@t_n
			set @t_tottotal = @total*@t_n
		end
		else
		begin
			set @t_totmount = @t_totmount + @mount*@t_n
			set @t_totweight = @t_totweight + @weight*@t_n
			set @t_tottotal = @t_tottotal + @total*@t_n
		end
		fetch next from cursor_table
		into @tggno,@typea,@datea,@mount,@weight,@total
	end
	close cursor_table
	deallocate cursor_table
	if @t_tggno!='@#S(DJ#SH!@'
	begin
		insert into @result
		select '1' gno,'' noa,'' noq,'小計' typea,'' datea,'' mon,@t_tggno tggno,'' comp,'' pno,'' pname,
			       '' unit,@t_totmount mount,@t_totweight weight,0 price,@t_tottotal total
	end
	--*****************************************************************************************	
	select gno,noa,noq,typea,datea,mon,tggno,comp,pno,pname,unit
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,mount),1)),4,12)) mount
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,weight),1)),0,12)) weight
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,price),1)),0,12)) price
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,total),1)),4,12)) total
	,'rc2a?noa=$noa?' qhref
	from @result order by tggno,gno,pno,datea,noa,noq;