zxls_ordera:--zxls_ordera.txt
---------------------------------------------------------------
declare @default_cno nvarchar(max) = 'A'
declare @default_acomp nvarchar(max) = '聯成金屬製造廠股份有限公司'
declare @default_custno nvarchar(max) = 'YL'
declare @default_comp nvarchar(max) = 'YL'
declare @default_stype nvarchar(max) = '1'
declare @now_date nvarchar(max)
set @now_date=CONVERT (VARCHAR(7), GETDATE(),12 )+0890000
set @now_date=left(@now_date,3)+'/'+substring(@now_date,4,2)+'/'+right(@now_date,2)
declare @default_orde_memo nvarchar(max) = @now_date + 'Orde'
declare @orde_deli nvarchar(max) = 'E'
declare @t_accy nvarchar(max) = left(@now_date,3)
declare @t_worker nvarchar(max) = [2]
declare @cmd nvarchar(max)
---------------------------------------------------------------
declare @a nvarchar(max)
declare @b nvarchar(max)
declare @c nvarchar(max)
declare @d nvarchar(max)
declare @e nvarchar(max)
declare @f nvarchar(max)
declare @g nvarchar(max)
declare @h nvarchar(max)
declare @i nvarchar(max)
declare @j nvarchar(max)
declare @k nvarchar(max)
declare @l nvarchar(max)
declare @m nvarchar(max)
declare @n nvarchar(max)
declare @o nvarchar(max)
declare @p nvarchar(max)
declare @q nvarchar(max)
declare @r nvarchar(max)
declare @s nvarchar(max)
declare @t nvarchar(max)
declare @u nvarchar(max)
declare @v nvarchar(max)
declare @w nvarchar(max)
declare @x nvarchar(max)
declare @y nvarchar(max)
declare @z nvarchar(max)
declare @aa nvarchar(max)
declare @ab nvarchar(max)
declare @ac nvarchar(max)
declare @ad nvarchar(max)
declare @ae nvarchar(max)
declare @af nvarchar(max)
declare @ag nvarchar(max)
declare @ah nvarchar(max)
declare @ai nvarchar(max)
declare @aj nvarchar(max)
declare @ak nvarchar(max)
declare @al nvarchar(max)
declare @am nvarchar(max)
declare @an nvarchar(max)
declare @ao nvarchar(max)
declare @ap nvarchar(max)
declare @aq nvarchar(max)
declare @ar nvarchar(max)
declare @as nvarchar(max)
declare @at nvarchar(max)
declare @au nvarchar(max)
declare @av nvarchar(max)
declare @aw nvarchar(max)
declare @ax nvarchar(max)
declare @ay nvarchar(max)
declare @az nvarchar(max)
declare @noa int
declare @tmp table(
	idno int identity(0,1),
	productno nvarchar(max),
	product nvarchar(max),
	stationno nvarchar(max),
	station nvarchar(max),
	stationgno nvarchar(max),
	stationg nvarchar(max),
	datea nvarchar(max),
	mount float
)
declare @thisday nvarchar(max) = ''
declare @thisVal float=0
declare cursor_table cursor for
	select a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,[as],at,au,av,aw,ax,ay,az,noa from ztmpxls where cast(noa as int) > 2 order by cast(noa as int)
open cursor_table
fetch next from cursor_table
into @a,@b,@c,@d,@e,@f,@g,@h,@i,@j,@k,@l,@m,@n,@o,@p,@q,@r,@s,@t,@u,@v,@w,@x,@y,@z,@aa,@ab,@ac,@ad,@ae,@af,@ag,@ah,@ai,@aj,@ak,@al,@am,@an,@ao,@ap,@aq,@ar,@as,@at,@au,@av,@aw,@ax,@ay,@az,@noa
while(@@FETCH_STATUS <> -1)
begin
	------------------------------------------------------------------
	select @thisday = g from ztmpxls where cast(noa as int) = 1
	set @thisVal = @g
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10), CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = h from ztmpxls where cast(noa as int) = 1
	set @thisVal = @h
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10), CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = i from ztmpxls where cast(noa as int) = 1
	set @thisVal = @i
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10), CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = j from ztmpxls where cast(noa as int) = 1
	set @thisVal = @j
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10), CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = k from ztmpxls where cast(noa as int) = 1
	set @thisVal = @k
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10), CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = l from ztmpxls where cast(noa as int) = 1
	set @thisVal = @l
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10), CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = m from ztmpxls where cast(noa as int) = 1
	set @thisVal = @m
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10), CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = n from ztmpxls where cast(noa as int) = 1
	set @thisVal = @n
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10), CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = o from ztmpxls where cast(noa as int) = 1
	set @thisVal = @o
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	select @thisday = p from ztmpxls where cast(noa as int) = 1
	set @thisVal = @p
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = q from ztmpxls where cast(noa as int) = 1
	set @thisVal = @q
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = r from ztmpxls where cast(noa as int) = 1
	set @thisVal = @r
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = s from ztmpxls where cast(noa as int) = 1
	set @thisVal = @s
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end	
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = t from ztmpxls where cast(noa as int) = 1
	set @thisVal = @t
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = u from ztmpxls where cast(noa as int) = 1
	set @thisVal = @u
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = v from ztmpxls where cast(noa as int) = 1
	set @thisVal = @v
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = w from ztmpxls where cast(noa as int) = 1
	set @thisVal = @w
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = x from ztmpxls where cast(noa as int) = 1
	set @thisVal = @x
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = y from ztmpxls where cast(noa as int) = 1
	set @thisVal = @y
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = z from ztmpxls where cast(noa as int) = 1
	set @thisVal = @z
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = aa from ztmpxls where cast(noa as int) = 1
	set @thisVal = @aa
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ab from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ab
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ac from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ac
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ad from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ad
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ae from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ae
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = af from ztmpxls where cast(noa as int) = 1
	set @thisVal = @af
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ag from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ag
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ah from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ah
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ai from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ai
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = aj from ztmpxls where cast(noa as int) = 1
	set @thisVal = @aj
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ak from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ak
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = al from ztmpxls where cast(noa as int) = 1
	set @thisVal = @al
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = am from ztmpxls where cast(noa as int) = 1
	set @thisVal = @am
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end	
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = an from ztmpxls where cast(noa as int) = 1
	set @thisVal = @an
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ao from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ao
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ap from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ap
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = aq from ztmpxls where cast(noa as int) = 1
	set @thisVal = @aq
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = ar from ztmpxls where cast(noa as int) = 1
	set @thisVal = @ar
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = [as] from ztmpxls where cast(noa as int) = 1
	set @thisVal = @as
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = at from ztmpxls where cast(noa as int) = 1
	set @thisVal = @at
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = au from ztmpxls where cast(noa as int) = 1
	set @thisVal = @au
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = av from ztmpxls where cast(noa as int) = 1
	set @thisVal = @av
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	------------------------------------------------------------------
	select @thisday = aw from ztmpxls where cast(noa as int) = 1
	set @thisVal = @aw
	if((charindex('/',@thisday)>0) and (@thisVal!=0))
	begin
		if(len(ltrim(rtrim(@thisday))) > 5)
		begin
			set @thisday=CONVERT (VARCHAR(10),  CONVERT(DATETIME, substring(@thisday,0,charindex(':',@thisday)-5), 111),12 )+0890000
			set @thisday=left(@thisday,3)+'/'+substring(@thisday,4,2)+'/'+right(@thisday,2)
		end
		insert into @tmp
			select
				a.d,a.e,b.noa,b.station,c.noa,a.g,@thisday,@thisVal
			from ztmpxls a
			left join station b on (a.f=b.station)
			left join stationg c on (a.g=c.namea)
			where cast(a.noa as int)=@noa
	end
	------------------------------------------------------------------
	fetch next from cursor_table
	into @a,@b,@c,@d,@e,@f,@g,@h,@i,@j,@k,@l,@m,@n,@o,@p,@q,@r,@s,@t,@u,@v,@w,@x,@y,@z,@aa,@ab,@ac,@ad,@ae,@af,@ag,@ah,@ai,@aj,@ak,@al,@am,@an,@ao,@ap,@aq,@ar,@as,@at,@au,@av,@aw,@ax,@ay,@az,@noa
end
close cursor_table
deallocate cursor_table
update @tmp set datea=@t_accy + '/' + RIGHT(REPLICATE('0', 2) + CAST(left(datea,charindex('/',datea)-1) as NVARCHAR), 2) + '/'+RIGHT(REPLICATE('0', 2) + CAST(right(datea,len(datea)-charindex('/',datea)) as NVARCHAR), 2) where (len(datea)=5)
--以上已將ztmpxls 的資料轉到@tmp並已經依日期列出(不合併) 日期以格式化--------------------------------------------------------------------------
declare @idno int
declare @productno nvarchar(max)
declare @product nvarchar(max)
declare @stationno nvarchar(max)
declare @station nvarchar(max)
declare @stationgno nvarchar(max)
declare @stationg nvarchar(max)
declare @datea nvarchar(10)
declare @mount float
declare @lastdatea nvarchar(10) = ''
IF OBJECT_ID('tempdb..#orde_tmp')is not null
BEGIN
	set @cmd = 'drop table #orde_tmp'
	EXECUTE sp_executesql @cmd
END
IF OBJECT_ID('tempdb..#ordes_tmp')is not null
BEGIN
	set @cmd = 'drop table #ordes_tmp'
	EXECUTE sp_executesql @cmd
END
create table #orde_tmp (
	noa int,
	datea nvarchar(10),
	odatea nvarchar(10),
	cno nvarchar(max),
	acomp nvarchar(max),
	custno nvarchar(max),
	comp nvarchar(max),
	stype nvarchar(10),
	memo nvarchar(max)
)
create table #ordes_tmp(
	noa int,
	no2 nvarchar(10),
	productno nvarchar(max),
	product nvarchar(max),
	spec nvarchar(max),
	style nvarchar(max),
	unit nvarchar(50),
	mount float,
	price float,
	total float,
	c1 float,
	notv float,
	datea nvarchar(10),
	custno nvarchar(max),
	memo nvarchar(max)
)
declare @w_noa int = 0
declare @w_noq int = 0
declare cursor_table cursor for
	select a.idno,a.datea from @tmp a where (isnull(a.datea,'') != '') and (isnull(a.productno,'') != '') order by a.datea,a.productno
open cursor_table
fetch next from cursor_table
into @idno,@datea
while(@@FETCH_STATUS <> -1)
begin
	if(@lastdatea != @datea)
	begin
		set @w_noa = @w_noa + 1
		set @w_noq = 0
		set @lastdatea = @datea
	end
	if(@w_noq = 0)
	begin
		insert into #orde_tmp
			select @w_noa,@datea,@datea,@default_cno,@default_acomp,
					 @default_custno,@default_comp,@default_stype,@default_orde_memo
	end
	set @w_noq = @w_noq+1
	insert into #ordes_tmp
		select
			@w_noa,RIGHT(REPLICATE('0', 3) + CAST(@w_noq as NVARCHAR), 3),a.productno,a.product,isnull(b.spec,''),isnull(b.style,''),isnull(b.unit,''),
			a.mount,0 price,0 total,0 c1,a.mount notv,a.datea,@default_custno,@default_orde_memo
		from @tmp a
		left join view_ucaucc b on (a.productno=b.noa)
		where a.idno=@idno
	fetch next from cursor_table
	into @idno,@datea
end
close cursor_table
deallocate cursor_table
declare @new_noa nvarchar(max)
-------匯入訂單All <<Start>>-------
declare cursor_table cursor for
	select a.noa,datea from #orde_tmp a order by a.datea
open cursor_table
fetch next from cursor_table
into @idno,@datea
while(@@FETCH_STATUS <> -1)
begin
	---------------------------取得最新的訂單編號<<Start>>
	select @new_noa = max(noa) from view_orde where left(noa,(7+(len(@orde_deli))))=(@orde_deli + replace(@datea,'/',''))
	if(@new_noa is null)
	begin
		set @new_noa = @orde_deli + replace(@datea,'/','') + '001'
	end
	else
	begin
		set @new_noa = @orde_deli + replace(@datea,'/','') + RIGHT(REPLICATE('0', 3) + CAST((cast(right(@new_noa,3) as int)+1) as NVARCHAR), 3)
	end
	---------------------------取得最新的訂單編號<<End>>
	---------------------------匯入訂單<<Start>>
	declare @thisNoaYear nvarchar(10) = left(@datea,3)
	set @cmd = 'insert into orde'+@thisNoaYear+'(noa,datea,odate,cno,acomp,custno,comp,stype,memo,enda,isproj,cancel,tel,fax,post,addr,paytype,trantype,salesno,sales) ' + 
						 'select ' + 
						 'N''' + @new_noa + ''',a.datea,a.odatea,a.cno,a.acomp,a.custno,a.comp,a.stype,a.memo,0,1,0,b.tel,b.fax,b.zip_comp,b.addr_comp,b.paytype,b.trantype,b.salesno,b.sales ' + 
						 'from #orde_tmp a ' + 
						 'outer apply(select * from cust where noa=a.custno) b ' + 
						 'where (a.noa='+cast(@idno as nvarchar)+') '
	EXECUTE sp_executesql @cmd
	set @cmd = 'insert into ordes'+@thisNoaYear+'(noa,no2,productno,product,spec,style,unit,mount,price,total,c1,notv,datea,custno,memo,enda,cancel) ' + 
						 'select ' + 
						 'N'''+@new_noa+''',a.no2,a.productno,a.product,a.spec,a.style,a.unit,a.mount,a.price,a.total,a.c1,a.notv,a.datea,a.custno,a.memo,0,0 ' + 
						 'from #ordes_tmp a ' + 
						 'where (a.noa='+cast(@idno as nvarchar)+') '
	EXECUTE sp_executesql @cmd
	---------------------------匯入訂單<<End>>
	fetch next from cursor_table
	into @idno,@datea
end
close cursor_table
deallocate cursor_table
-------匯入訂單All <<End>>-------
IF OBJECT_ID('tempdb..#orde_tmp')is not null
BEGIN
	set @cmd = 'drop table #orde_tmp'
	EXECUTE sp_executesql @cmd
END
IF OBJECT_ID('tempdb..#ordes_tmp')is not null
BEGIN
	set @cmd = 'drop table #ordes_tmp'
	EXECUTE sp_executesql @cmd
END
;