z_driver3:--z_driver3
	declare @t_accy nvarchar(10)	
	declare @t_bdriverno nvarchar(20)
	declare @t_edriverno nvarchar(20)
	
	set @t_accy = '[1]'
	set @t_bdriverno = case when '#non'=[2] then '' else [2] end
	set @t_edriverno = case when '#non'=[3] then CHAR(255) else [3] end
------------------------------------------------------------------------------------ 
select '0' gno,ROW_NUMBER()over(order by noa) rec,noa,namea,account2 aa,bankno2 bankno2,accountname2 bb,bank2 cc  
from driver 
where len(ISNULL(account2,''))>0 and (noa between @t_bdriverno and @t_edriverno) 
order by noa ;

z_driver2:--z_driver2
	declare @t_accy nvarchar(10)	
	declare @t_bdriverno nvarchar(20)
	declare @t_edriverno nvarchar(20)
	
	set @t_accy = '[1]'
	set @t_bdriverno = case when '#non'=[2] then '' else [2] end
	set @t_edriverno = case when '#non'=[3] then CHAR(255) else [3] end
	------------------------------------------------------------------------------------
	select '0' gno,ROW_NUMBER()over(order by noa) rec,noa,namea,account aa,accountname bb
	from driver
	where len(ISNULL(account,''))>0 and (noa between @t_bdriverno and @t_edriverno)
	order by noa;
	
z_driver1:--z_driver1
	declare @t_accy nvarchar(10)	
	declare @t_bdriverno nvarchar(20)
	declare @t_edriverno nvarchar(20)
	
	set @t_accy = '[1]'
	set @t_bdriverno = case when '#non'=[2] then '' else [2] end
	set @t_edriverno = case when '#non'=[3] then CHAR(255) else [3] end
	------------------------------------------------------------------------------------
	declare @driverno nvarchar(20)
	declare @string nvarchar(max)
	declare @namea nvarchar(20)
	------------------------------------------------------------------------------------ 
	declare @tmp table(
		gno nvarchar(3),
		recno int,
		cno nvarchar(20),
		acomp nvarchar(20),
		driverno nvarchar(20),
		driver nvarchar(20),
		takeofficedate nvarchar(10),
		years int,
		months int,
		labor float,
		health float,
		pensionfund float,
		[money] float,
		dependents int,
		memo nvarchar(max)
	)
	insert into @tmp 
	select '0',ROW_NUMBER()over(order by a.cardealno,a.noa),isnull(a.cardealno,''),isnull(b.nick,'') 
	,a.noa,a.namea,a.takeofficedate
	,case when len(RTRIM(a.takeofficedate))=0 then null else floor(DATEDIFF(MM,CAST(cast(cast(left(a.takeofficedate,3) as int)+1911 as nvarchar(4))+right(a.takeofficedate,6) as date),GETDATE())/12) end
	,case when len(RTRIM(a.takeofficedate))=0 then null else DATEDIFF(MM,CAST(cast(cast(left(a.takeofficedate,3) as int)+1911 as nvarchar(4))+right(a.takeofficedate,6) as date),GETDATE())%12 end
	,a.labor,a.health,a.pensionfund,a.[money],a.dependents,a.memo 
	from driver a 
	left join acomp b on a.cardealno=b.noa 
	where len(a.mark)>0 and (a.noa between @t_bdriverno and @t_edriverno) 
	order by a.cardealno,a.noa
	
	declare cursor_table cursor for
	select driverno from @tmp group by driverno
	open cursor_table
	fetch next from cursor_table
	into @driverno
	while(@@FETCH_STATUS <> -1)
	begin
		set @string = ''
		declare cursor_table2 cursor for
		select namea from labases where noa=@driverno 
		open cursor_table2
		fetch next from cursor_table2
		into @namea
		while(@@FETCH_STATUS <> -1)
		begin
			set @string = @string+case when LEN(@string)=0 then '' else ',' end + @namea
			
			fetch next from cursor_table2
			into @namea
		end
		close cursor_table2
		deallocate cursor_table2
	
		if LEN(@string)>0
			update @tmp set memo=(memo+case when len(memo)>0 then '#' else '' end+@string) where driverno=@driverno
		fetch next from cursor_table
		into @driverno
	end
	close cursor_table
	deallocate cursor_table

	insert into @tmp 
	select '1',null,cno,acomp,'','','',null,null,SUM(labor),SUM(health),SUM(pensionfund),SUM(labor+health+pensionfund),null,'' 
	from @tmp where gno='0' group by cno,acomp 
	insert into @tmp 
	select '2',null,CHAR(255),'','','','',null,null,SUM(labor),SUM(health),SUM(pensionfund),SUM(labor+health+pensionfund),null,'' 
	from @tmp where gno='0'

	select * 
	,case when years>0 or months>0 then cast(years as char(2))+'/'+cast(months as char(2)) else null end zz
	,recno aa
	,acomp bb
	,driver cc
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,labor),1)),4,12)) dd
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,health),1)),4,12)) ee
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,pensionfund),1)),4,12)) ff
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,[money]),1)),4,12)) gg
	,reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,dependents),1)),4,12)) hh
	,replace(memo,'chr(10)',char(10)) ii
	from @tmp order by cno,ISNULL(recno,9999) ;