workusave:--workusave
declare @t_noa nvarchar(50) = [1]
declare @cmd nvarchar(max)
declare @tmp table(
	noa nvarchar(50),
	noq nvarchar(10),
	workfno nvarchar(50),
	workfnoq nvarchar(10),
	workfyear nvarchar(10),
	mount float
)
insert into @tmp
	select
		a.noa,a.noq,a.workfno,a.workfnoq,b.accy,a.mount
	from view_workus a
	outer apply(select top 1 accy from view_workf where noa=a.workfno) b
	where (a.noa=@t_noa) and (isnull(a.workfno,'') != '') and (isnull(b.accy,'') != '')
declare @workfno nvarchar(50)
declare @workfnoq nvarchar(10)
declare @workfyear nvarchar(10)
declare @mount float
declare cursor_table cursor for
	select
		a.workfno,a.workfnoq,a.workfyear,a.mount
	from @tmp a
	order by a.noa,a.noq
open cursor_table
fetch next from cursor_table
into @workfno,@workfnoq,@workfyear,@mount
while(@@FETCH_STATUS <> -1)
begin
	set @cmd = 'update workfs' + @workfyear + ' set tmount=' + @mount + ' where noa=N''' + @workfno + ''' and noq=N''' + @workfnoq + ''''
	EXECUTE sp_executesql @cmd
	fetch next from cursor_table
	into @workfno,@workfnoq,@workfyear,@mount
end
close cursor_table
deallocate cursor_table
;