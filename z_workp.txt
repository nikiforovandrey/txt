z_workp1:--z_workp1
declare @t_noa nvarchar(30)
set @t_noa = case when '#non' = [2] then '' else  [2] end
declare @tmp table(
	gno nvarchar(1),
	bnoa nvarchar(30),
	bproductno nvarchar(30),
	bproducts nvarchar(90),
	bmount float,
	bunit nvarchar(12),
	bprocess nvarchar(90),
	bordeno nvarchar(30),
	bnom nvarchar(30),
	bcuadate nvarchar(10),
	benddate nvarchar(10),
	anoq nvarchar(3),
	aproductno nvarchar(30),
	aproducts nvarchar(90),
	amount float,
	aunit nvarchar(12),
	amemo nvarchar(max)
)
insert into @tmp
select
	'0',b.noa,b.productno,b.product,b.mount,b.unit,b.process,b.ordeno,b.noa,b.cuadate,b.enddate,
	a.noq,a.productno,a.product,a.mount,a.unit,a.memo
from works[1] a
left join work[1] b on a.noa = b.noa
where (len(@t_noa) =0 or b.noa = @t_noa)
order by b.noa,a.noq
insert into @tmp(bnoa,gno)
	select distinct bnoa,'1' from @tmp group by bnoa
select
	gno,bnoa,bproductno,bproducts,
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,bmount),1)),4,12)) bmount,
	bunit,bprocess,bordeno,bnom,bcuadate,benddate,anoq,aproductno,
	aproducts,
	reverse(substring(reverse(convert(nvarchar(15),CONVERT(money,amount),1)),4,12)) amount,aunit,amemo
from @tmp order by bnoa,gno,anoq;